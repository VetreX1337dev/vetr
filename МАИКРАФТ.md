-- Services
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

-- Переменные для Kill Aura
local player = game.Players.LocalPlayer
local Attack = ReplicatedStorage:WaitForChild("GameRemotes"):WaitForChild("Attack")

-- Настройки
local killAuraEnabled = false
local ignoreNakedEnabled = false
local MAX_DISTANCE = 80
local MIN_SCALE = 2.6
local MAX_SCALE = 3.6
local BASE_SIZE = 70
local SMOOTH_FADE = 10
local SMOOTH_SCALE = 8
local ROT_ANGLE = 40
local ROT_SPEED = 2
local VERTICAL_OFFSET = 2.5
local TARGET_DISTANCE = 80
local ATTACK_COOLDOWN = 0.1

-- Настройки Player
local infiniteJumpEnabled = false
local customWalkSpeed = 16
local originalWalkSpeed = 16
local originalJumpPower = 50

-- Запускаем FPS/Ping скрипт сразу при активации
-- by https://t.me/vomagla--
loadstring(game:HttpGet("https://raw.githubusercontent.com/GLAMOHGA/fling/refs/heads/main/хз%20как%20назвать%20типо%20фпс%20и%20пинг.md"))()

-- UI Setup для таргетинга
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TargetHUD"
screenGui.ResetOnSpawn = false
screenGui.Parent = game.CoreGui

-- Notification GUI
local notificationGui = Instance.new("ScreenGui")
notificationGui.Name = "NotificationHUD"
notificationGui.ResetOnSpawn = false
notificationGui.Parent = game.CoreGui

local notificationFrame = Instance.new("Frame", notificationGui)
notificationFrame.Size = UDim2.new(0, 300, 0, 60)
notificationFrame.Position = UDim2.new(1, -320, 1, -80)
notificationFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
notificationFrame.BackgroundTransparency = 1
notificationFrame.Visible = false

local notifCorner = Instance.new("UICorner", notificationFrame)
notifCorner.CornerRadius = UDim.new(0, 12)

local notifStroke = Instance.new("UIStroke", notificationFrame)
notifStroke.Color = Color3.fromRGB(255, 50, 50)
notifStroke.Thickness = 2
notifStroke.Transparency = 1

local notifGlow = Instance.new("ImageLabel", notificationFrame)
notifGlow.Size = UDim2.new(1, 20, 1, 20)
notifGlow.Position = UDim2.new(0, -10, 0, -10)
notifGlow.BackgroundTransparency = 1
notifGlow.Image = "rbxassetid://8992230675"
notifGlow.ImageColor3 = Color3.fromRGB(255, 50, 50)
notifGlow.ImageTransparency = 1
notifGlow.ScaleType = Enum.ScaleType.Slice
notifGlow.SliceCenter = Rect.new(20, 20, 20, 20)

local notifText = Instance.new("TextLabel", notificationFrame)
notifText.Size = UDim2.new(1, -20, 1, 0)
notifText.Position = UDim2.new(0, 10, 0, 0)
notifText.BackgroundTransparency = 1
notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
notifText.Font = Enum.Font.GothamBold
notifText.TextSize = 16
notifText.Text = ""
notifText.TextStrokeTransparency = 0.8
notifText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)

-- Основной контейнер TargetHUD
local targetGui = Instance.new("Frame", screenGui)
targetGui.Size = UDim2.new(0, 350, 0, 140)
targetGui.Position = UDim2.new(0.5, -175, 0.7, 0)
targetGui.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
targetGui.BackgroundTransparency = 1
targetGui.Visible = false

local corner = Instance.new("UICorner", targetGui)
corner.CornerRadius = UDim.new(0, 12)

local stroke = Instance.new("UIStroke", targetGui)
stroke.Color = Color3.fromRGB(255, 50, 50)
stroke.Thickness = 2
stroke.Transparency = 0.5

local glow = Instance.new("ImageLabel", targetGui)
glow.Size = UDim2.new(1, 20, 1, 20)
glow.Position = UDim2.new(0, -10, 0, -10)
glow.BackgroundTransparency = 1
glow.Image = "rbxassetid://8992230675"
glow.ImageColor3 = Color3.fromRGB(255, 50, 50)
glow.ImageTransparency = 0.9
glow.ScaleType = Enum.ScaleType.Slice
glow.SliceCenter = Rect.new(20, 20, 20, 20)

-- Левая часть: аватар игрока
local avatarContainer = Instance.new("Frame", targetGui)
avatarContainer.Size = UDim2.new(0, 80, 0, 80)
avatarContainer.Position = UDim2.new(0.05, 0, 0.1, 0)
avatarContainer.BackgroundTransparency = 1

local playerAvatar = Instance.new("ImageLabel", avatarContainer)
playerAvatar.Size = UDim2.new(1, 0, 1, 0)
playerAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
playerAvatar.BackgroundTransparency = 0.2
playerAvatar.Image = "rbxassetid://0"
playerAvatar.ScaleType = Enum.ScaleType.Crop

local avatarCorner = Instance.new("UICorner", playerAvatar)
avatarCorner.CornerRadius = UDim.new(0, 8)

local avatarStroke = Instance.new("UIStroke", playerAvatar)
avatarStroke.Color = Color3.fromRGB(255, 50, 50)
avatarStroke.Thickness = 2

-- Правая часть: информация
local infoContainer = Instance.new("Frame", targetGui)
infoContainer.Size = UDim2.new(0.6, 0, 0.8, 0)
infoContainer.Position = UDim2.new(0.3, 0, 0.1, 0)
infoContainer.BackgroundTransparency = 1

-- Имя цели
local nameLabel = Instance.new("TextLabel", infoContainer)
nameLabel.Size = UDim2.new(1, 0, 0.2, 0)
nameLabel.BackgroundTransparency = 1
nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
nameLabel.Font = Enum.Font.GothamBold
nameLabel.TextSize = 18
nameLabel.TextXAlignment = Enum.TextXAlignment.Left
nameLabel.Text = "None"

-- Контейнер для полоски здоровья
local healthContainer = Instance.new("Frame", infoContainer)
healthContainer.Size = UDim2.new(1, 0, 0.4, 0)
healthContainer.Position = UDim2.new(0, 0, 0.25, 0)
healthContainer.BackgroundTransparency = 1

local healthBarBackground = Instance.new("Frame", healthContainer)
healthBarBackground.Size = UDim2.new(1, 0, 0.6, 0)
healthBarBackground.Position = UDim2.new(0, 0, 0, 0)
healthBarBackground.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
healthBarBackground.BackgroundTransparency = 0.4
healthBarBackground.ClipsDescendants = true

local bgCorner = Instance.new("UICorner", healthBarBackground)
bgCorner.CornerRadius = UDim.new(0, 6)

local bgStroke = Instance.new("UIStroke", healthBarBackground)
bgStroke.Color = Color3.fromRGB(60, 60, 60)
bgStroke.Thickness = 1

local healthBar = Instance.new("Frame", healthBarBackground)
healthBar.Size = UDim2.new(1, 0, 1, 0)
healthBar.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
healthBar.ClipsDescendants = true

local gradient = Instance.new("UIGradient", healthBar)
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 50, 50)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 150, 50)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 255, 50))
})
gradient.Rotation = 90

local barCorner = Instance.new("UICorner", healthBar)
barCorner.CornerRadius = UDim.new(0, 6)

local barGlow = Instance.new("ImageLabel", healthBar)
barGlow.Size = UDim2.new(1, 10, 1, 10)
barGlow.Position = UDim2.new(0, -5, 0, -5)
barGlow.BackgroundTransparency = 1
barGlow.Image = "rbxassetid://8992230675"
barGlow.ImageColor3 = Color3.fromRGB(255, 100, 100)
barGlow.ImageTransparency = 0.8
barGlow.ScaleType = Enum.ScaleType.Slice
barGlow.SliceCenter = Rect.new(20, 20, 20, 20)

local healthTextContainer = Instance.new("Frame", healthContainer)
healthTextContainer.Size = UDim2.new(1, 0, 0.4, 0)
healthTextContainer.Position = UDim2.new(0, 0, 0.65, 0)
healthTextContainer.BackgroundTransparency = 1

local healthValue = Instance.new("TextLabel", healthTextContainer)
healthValue.Size = UDim2.new(1, 0, 1, 0)
healthValue.BackgroundTransparency = 1
healthValue.TextColor3 = Color3.fromRGB(255, 255, 255)
healthValue.Font = Enum.Font.GothamSemibold
healthValue.TextSize = 14
healthValue.TextXAlignment = Enum.TextXAlignment.Left
healthValue.Text = "0/0 HP"

local damageEffect = Instance.new("Frame", healthBar)
damageEffect.Size = UDim2.new(1, 0, 1, 0)
damageEffect.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
damageEffect.BackgroundTransparency = 1
damageEffect.ZIndex = 2

local effectCorner = Instance.new("UICorner", damageEffect)
effectCorner.CornerRadius = UDim.new(0, 6)

-- Дистанция до цели
local distanceLabel = Instance.new("TextLabel", infoContainer)
distanceLabel.Size = UDim2.new(1, 0, 0.2, 0)
distanceLabel.Position = UDim2.new(0, 0, 0.7, 0)
distanceLabel.BackgroundTransparency = 1
distanceLabel.TextColor3 = Color3.fromRGB(150, 150, 255)
distanceLabel.Font = Enum.Font.Gotham
distanceLabel.TextSize = 12
distanceLabel.TextXAlignment = Enum.TextXAlignment.Left
distanceLabel.Text = "Distance: -- studs"

-- Функция для получения аватара игрока
local function getPlayerAvatar(userId)
    local userIdStr = tostring(userId)
    local avatarUrl = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. userIdStr .. "&width=150&height=150&format=png"
    return avatarUrl
end

-- Функция показа уведомления
local function showNotification(text, isEnabled)
    notifText.Text = text
    notificationFrame.Visible = true
    notificationFrame.BackgroundTransparency = 1
    
    if isEnabled then
        notifStroke.Color = Color3.fromRGB(50, 255, 50)
        notifGlow.ImageColor3 = Color3.fromRGB(50, 255, 50)
    else
        notifStroke.Color = Color3.fromRGB(255, 50, 50)
        notifGlow.ImageColor3 = Color3.fromRGB(255, 50, 50)
    end
    
    notifStroke.Transparency = 1
    notifGlow.ImageTransparency = 1
    
    local showTween = TweenService:Create(notificationFrame, 
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0.2}
    )
    local strokeTween = TweenService:Create(notifStroke, 
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Transparency = 0.3}
    )
    local glowTween = TweenService:Create(notifGlow, 
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {ImageTransparency = 0.7}
    )
    
    showTween:Play()
    strokeTween:Play()
    glowTween:Play()
    
    task.spawn(function()
        task.wait(2)
        local hideTween = TweenService:Create(notificationFrame, 
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
            {BackgroundTransparency = 1}
        )
        local strokeHideTween = TweenService:Create(notifStroke, 
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
            {Transparency = 1}
        )
        local glowHideTween = TweenService:Create(notifGlow, 
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
            {ImageTransparency = 1}
        )
        
        hideTween:Play()
        strokeHideTween:Play()
        glowHideTween:Play()
        
        hideTween.Completed:Connect(function()
            notificationFrame.Visible = false
        end)
    end)
end

-- Анимация пульсации
local pulseTween
local function pulseAnimation()
    if pulseTween then pulseTween:Cancel() end
    
    pulseTween = TweenService:Create(
        stroke,
        TweenInfo.new(0.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
        {Transparency = 0}
    )
    pulseTween:Play()
end

local lastHealth = 0
local lastMaxHealth = 0
local damageTween

-- ESP GUI Setup
local espGui = Instance.new("ScreenGui")
espGui.Name = "TargetESP"
espGui.ResetOnSpawn = false
espGui.Parent = player:WaitForChild("PlayerGui")

local espImage = Instance.new("ImageLabel")
espImage.Size = UDim2.new(0, BASE_SIZE, 0, BASE_SIZE)
espImage.AnchorPoint = Vector2.new(0.5, 0.5)
espImage.BackgroundTransparency = 1
espImage.Image = "rbxassetid://133065276440430"
espImage.ImageColor3 = Color3.fromRGB(255, 50, 50)
espImage.Visible = false
espImage.ZIndex = 0
espImage.Parent = espGui

-- Переменные для работы Kill Aura
local currentTarget = nil
local currentTargetPlayer = nil
local lastAttackTime = 0
local canAttack = true
local attackConnection = nil
local initialTargetSet = false -- Флаг для фиксации первой цели
local lastAttackSuccess = false -- Для исправления задержки

-- Проверяем доступность атаки (исправленная версия)
local function canAttackNow()
    if not canAttack then
        return false
    end
    
    -- Если последняя атака была успешной, используем нормальный коолдаун
    if lastAttackSuccess then
        return (tick() - lastAttackTime) >= ATTACK_COOLDOWN
    else
        -- Если атака не сработала, пробуем снова быстрее
        return (tick() - lastAttackTime) >= 0.05
    end
end

-- Функция получения ближайшего игрока (ПРОСТАЯ ВЕРСИЯ С ФИКСАЦИЕЙ)
local function getClosestPlayer()
    -- Если цель уже выбрана и она жива/доступна - возвращаем ее
    if currentTarget and currentTarget.Parent and currentTarget:FindFirstChild("HumanoidRootPart") and 
       currentTarget:FindFirstChild("Humanoid") and currentTarget.Humanoid.Health > 0 then
        local distance = (currentTarget.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).magnitude
        if distance <= TARGET_DISTANCE then
            return currentTarget, currentTargetPlayer, distance
        end
    end
    
    -- Ищем новую цель (самого ближайшего)
    local closestPlayer
    local closestPlayerObj
    local shortestDistance = math.huge
    
    for _, v in pairs(game.Players:GetPlayers()) do
        if v ~= player and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (v.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).magnitude
            
            if ignoreNakedEnabled and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.MaxHealth <= 100 then
                continue
            end
            
            if v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health <= 0 then
                continue
            end
            
            if distance < shortestDistance then
                closestPlayer = v.Character
                closestPlayerObj = v
                shortestDistance = distance
            end
        end
    end
    
    -- Фиксируем первую цель при включении Kill Aura
    if not initialTargetSet and closestPlayer then
        currentTarget = closestPlayer
        currentTargetPlayer = closestPlayerObj
        initialTargetSet = true
        return closestPlayer, closestPlayerObj, shortestDistance
    end
    
    -- Если старая цель недоступна, ищем новую
    if not currentTarget or not currentTarget.Parent then
        currentTarget = closestPlayer
        currentTargetPlayer = closestPlayerObj
    end
    
    return currentTarget, currentTargetPlayer, shortestDistance
end

-- Функция атаки цели (исправленная)
local function attackTarget(target)
    if not target or not target:FindFirstChild("Humanoid") or target.Humanoid.Health <= 0 then
        lastAttackSuccess = false
        return
    end
    
    if canAttackNow() then
        canAttack = false
        lastAttackTime = tick()
        
        local success = pcall(function()
            Attack:InvokeServer(target)
            lastAttackSuccess = true
        end)
        
        if not success then
            task.spawn(function()
                local success2 = pcall(function()
                    Attack:InvokeServer(target)
                    lastAttackSuccess = true
                end)
                if not success2 then
                    lastAttackSuccess = false
                end
            end)
        end
        
        task.delay(ATTACK_COOLDOWN, function()
            canAttack = true
        end)
    end
end

-- Функция плавного обновления полоски здоровья
local function smoothUpdateHealthBar(currentHealth, maxHealth)
    if maxHealth > 0 then
        local targetSize = math.min(currentHealth / maxHealth, 1)
        
        local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(healthBar, tweenInfo, {
            Size = UDim2.new(targetSize, 0, 1, 0)
        })
        tween:Play()
        
        if currentHealth < lastHealth and lastHealth > 0 then
            if damageTween then damageTween:Cancel() end
            
            damageEffect.BackgroundTransparency = 0.3
            damageTween = TweenService:Create(damageEffect, 
                TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundTransparency = 1}
            )
            damageTween:Play()
        end
        
        healthValue.Text = string.format("%d/%d HP", math.floor(currentHealth), math.floor(maxHealth))
        
        local percent = currentHealth / maxHealth
        if percent > 0.6 then
            gradient.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 255, 50)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 255, 50))
            })
            barGlow.ImageColor3 = Color3.fromRGB(100, 255, 100)
        elseif percent > 0.3 then
            gradient.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 200, 50)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 150, 50))
            })
            barGlow.ImageColor3 = Color3.fromRGB(255, 200, 100)
        else
            gradient.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 50, 50)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 50))
            })
            barGlow.ImageColor3 = Color3.fromRGB(255, 100, 100)
        end
        
        lastHealth = currentHealth
        lastMaxHealth = maxHealth
    end
end

-- Функции для Player настроек
local function updatePlayerSpeed()
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.WalkSpeed = customWalkSpeed
    end
end

-- Автоматическое восстановление скорости при респавне и постоянная проверка
local function setupSpeedMonitor()
    game:GetService("Players").LocalPlayer.CharacterAdded:Connect(function(character)
        task.wait(0.5) -- Ждем пока персонаж загрузится
        if character:FindFirstChild("Humanoid") then
            updatePlayerSpeed()
        end
    end)
    
    -- Постоянная проверка скорости
    RunService.Heartbeat:Connect(function()
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            local currentSpeed = player.Character.Humanoid.WalkSpeed
            if currentSpeed ~= customWalkSpeed then
                updatePlayerSpeed()
            end
        end
    end)
end

-- Вызываем монитор скорости
setupSpeedMonitor()

local function applyInfiniteJump()
    if infiniteJumpEnabled then
        UserInputService.JumpRequest:Connect(function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    end
end

-- ESP Logic
local function GetNearest()
    local closest, dist = nil, MAX_DISTANCE
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player and p.Character then
            local r = p.Character:FindFirstChild("HumanoidRootPart")
            local h = p.Character:FindFirstChild("Humanoid")
            if r and h and h.Health > 0 then
                if ignoreNakedEnabled and h.MaxHealth <= 100 then
                    continue
                end
                
                local d = (r.Position - player.Character.HumanoidRootPart.Position).Magnitude
                if d < dist then
                    closest = p
                    dist = d
                end
            end
        end
    end
    return closest, dist
end

local currentTransparency = 0
local currentScale = 1
local tclock = 0
local camera = workspace.CurrentCamera

local function lerp(a, b, t) 
    return a + (b - a) * t 
end

-- Toggle на R
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.R then
        killAuraEnabled = not killAuraEnabled
        
        if attackConnection then
            attackConnection:Disconnect()
            attackConnection = nil
        end
        
        if killAuraEnabled then
            showNotification("Kill Aura - ВКЛЮЧЕНО", true)
            
            -- Сбрасываем фиксацию цели при включении
            currentTarget = nil
            currentTargetPlayer = nil
            initialTargetSet = false
            
            attackConnection = RunService.Heartbeat:Connect(function()
                if killAuraEnabled then
                    local target, targetPlayer, distance = getClosestPlayer()
                    if target and distance <= TARGET_DISTANCE then
                        attackTarget(target)
                    end
                end
            end)
        else
            espImage.Visible = false
            targetGui.Visible = false
            if pulseTween then pulseTween:Cancel() end
            stroke.Transparency = 0.5
            currentTarget = nil
            currentTargetPlayer = nil
            initialTargetSet = false
            showNotification("Kill Aura - ВЫКЛЮЧЕНО", false)
        end
    end
end)

-- Main loops для интерфейса
RunService.RenderStepped:Connect(function(dt)
    if killAuraEnabled then
        tclock += dt * ROT_SPEED
        
        local espTarget, espDist = GetNearest()
        local target, targetPlayer, distance = getClosestPlayer()
        
        if target and distance <= TARGET_DISTANCE then
            local tRoot = target:FindFirstChild("HumanoidRootPart")
            
            if tRoot then
                local targetPos = tRoot.Position + Vector3.new(0, VERTICAL_OFFSET, 0)
                local screenPos, onScreen = camera:WorldToViewportPoint(targetPos)
                
                local avatarUrl = getPlayerAvatar(targetPlayer.UserId)
                playerAvatar.Image = avatarUrl
                
                nameLabel.Text = targetPlayer.Name
                distanceLabel.Text = string.format("Distance: %d studs", math.floor(distance))
                
                local humanoid = target.Humanoid
                if humanoid then
                    smoothUpdateHealthBar(humanoid.Health, humanoid.MaxHealth)
                end
                
                if not targetGui.Visible then
                    targetGui.Visible = true
                    targetGui.BackgroundTransparency = 1
                    local showTween = TweenService:Create(targetGui, 
                        TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
                        {BackgroundTransparency = 0.3}
                    )
                    showTween:Play()
                    pulseAnimation()
                end
                
                if onScreen and distance <= MAX_DISTANCE then
                    espImage.Visible = true
                    espImage.Position = UDim2.new(0, screenPos.X, 0, screenPos.Y)
                    
                    local alpha = math.clamp(distance / MAX_DISTANCE, 0, 1)
                    local targetScale = MAX_SCALE * (1 - alpha) + MIN_SCALE * alpha
                    
                    currentScale = lerp(currentScale, targetScale, dt * SMOOTH_SCALE)
                    
                    espImage.Size = UDim2.new(0, BASE_SIZE * currentScale, 0, BASE_SIZE * currentScale)
                    espImage.Rotation = math.sin(tclock) * ROT_ANGLE
                    
                    if distance <= 20 then
                        espImage.ImageColor3 = Color3.fromRGB(255, 50, 50)
                    elseif distance <= 50 then
                        espImage.ImageColor3 = Color3.fromRGB(255, 150, 50)
                    elseif distance <= 70 then
                        espImage.ImageColor3 = Color3.fromRGB(50, 200, 255)
                    else
                        espImage.ImageColor3 = Color3.fromRGB(100, 100, 255)
                    end
                else
                    espImage.Visible = false
                end
            end
        else
            espImage.Visible = false
            if targetGui.Visible then
                local hideTween = TweenService:Create(targetGui, 
                    TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
                    {BackgroundTransparency = 1}
                )
                hideTween:Play()
                hideTween.Completed:Connect(function()
                    targetGui.Visible = false
                    targetGui.BackgroundTransparency = 1
                    if pulseTween then pulseTween:Cancel() end
                    stroke.Transparency = 0.5
                end)
            end
            lastHealth = 0
            lastMaxHealth = 0
        end
    else
        espImage.Visible = false
        if targetGui.Visible then
            local hideTween = TweenService:Create(targetGui, 
                TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
                {BackgroundTransparency = 1}
            )
            hideTween:Play()
            hideTween.Completed:Connect(function()
                targetGui.Visible = false
                targetGui.BackgroundTransparency = 1
                if pulseTween then pulseTween:Cancel() end
                stroke.Transparency = 0.5
            end)
        end
    end
end)

-- Borealis UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/magbux/BorealisUiLib/refs/heads/main/Library.Lua"))()
local Window = Library.new("Kill Aura Settings")

-- Сообщение при запуске
showNotification("Меню: Правый Shift - Открыть/Закрыть", true)

-- Keybind для открытия/закрытия меню
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.RightShift then
        Window:toggle()
    end
end)

-- Главная вкладка
local MainTab = Window:MakeTab("Main")
local MainSection = MainTab:AddSection()

MainSection:AddLabel("Kill Aura Settings")

MainSection:AddButton({
    Name = "Kill Aura Toggle",
    Callback = function()
        Window:Notification("Информация", "Kill Aura включается/выключается на клавишу R", 3)
    end
})

MainSection:AddButton({
    Name = "Задержка Kill Aura 0.05",
    Callback = function()
        ATTACK_COOLDOWN = 0.05
        Window:Notification("Настройка", "Задержка Kill Aura установлена на 0.05 секунды", 2)
    end
})

MainSection:AddButton({
    Name = "Задержка Kill Aura 0.1",
    Callback = function()
        ATTACK_COOLDOWN = 0.1
        Window:Notification("Настройка", "Задержка Kill Aura установлена на 0.1 секунды", 2)
    end
})

MainSection:AddButton({
    Name = "Задержка Kill Aura 0.2",
    Callback = function()
        ATTACK_COOLDOWN = 0.2
        Window:Notification("Настройка", "Задержка Kill Aura установлена на 0.2 секунды", 2)
    end
})

MainSection:AddButton({
    Name = "Задержка Kill Aura 0.3",
    Callback = function()
        ATTACK_COOLDOWN = 0.3
        Window:Notification("Настройка", "Задержка Kill Aura установлена на 0.3 секунды", 2)
    end
})

MainSection:AddToggle({
    Name = "Игнорировать голых",
    Default = false,
    Callback = function(Value)
        ignoreNakedEnabled = Value
        if Value then
            Window:Notification("Настройка", "Игнорирование голых игроков - ВКЛЮЧЕНО", 2)
        else
            Window:Notification("Настройка", "Игнорирование голых игроков - ВЫКЛЮЧЕНО", 2)
        end
    end
})

-- Вкладка Player
local PlayerTab = Window:MakeTab("Player")
local PlayerSection = PlayerTab:AddSection()

PlayerSection:AddLabel("Player Settings")

PlayerSection:AddToggle({
    Name = "Infinity Jump",
    Default = false,
    Callback = function(Value)
        infiniteJumpEnabled = Value
        if Value then
            applyInfiniteJump()
            Window:Notification("Player", "Бесконечный прыжок - ВКЛЮЧЕН", 2)
        else
            Window:Notification("Player", "Бесконечный прыжок - ВЫКЛЮЧЕН", 2)
        end
    end
})

PlayerSection:AddSlider({
    Name = "Walk Speed",
    Min = 16,
    Max = 100,
    Default = 16,
    Callback = function(Value)
        customWalkSpeed = Value
        updatePlayerSpeed()
        Window:Notification("Player", "Скорость установлена: " .. Value, 2)
    end
})

































